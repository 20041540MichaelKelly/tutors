var p=Object.defineProperty;var d=(e,t,s)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var o=(e,t,s)=>(d(e,typeof t!="symbol"?t+"":t,s),s);import{c as m,f as T,w as f,a as n}from"./stores.e6516f52.js";import{c as l,r as C,C as h}from"./course.d958946a.js";function c(e){return(e==null?void 0:e.length)>16?e.substring(0,15)+"...":e}class g{constructor(t,s,r){o(this,"course");o(this,"lo",null);o(this,"url","");o(this,"objectivesHtml","");o(this,"currentChapterShortTitle","");o(this,"currentChapterTitle","");o(this,"navbarHtml","");o(this,"horizontalNavbarHtml","");o(this,"content","");o(this,"chaptersHtml",new Map);o(this,"chaptersTitles",new Map);o(this,"steps",[]);o(this,"autoNumber",!1);o(this,"vertical",!0);this.course=t,this.autoNumber=t.areLabStepsAutoNumbered(),this.url=r,this.lo=s,this.convertMdToHtml()}convertMdToHtml(){const t=this.url.replace(`/lab/${this.course.id}`,this.course.url);this.objectivesHtml=l(this.lo.los[0].contentMd,t),this.chaptersHtml=new Map(this.lo.los.map(s=>[encodeURI(s.shortTitle),l(s.contentMd,t)])),this.chaptersTitles=new Map(this.lo.los.map(s=>[s.shortTitle,C(s.title)])),this.steps=Array.from(this.chaptersHtml.keys())}refreshNav(){const t=this.autoNumber?this.lo.shortTitle+": ":"";this.navbarHtml=this.lo.los.map(r=>{const i=encodeURI(r.shortTitle)===this.currentChapterShortTitle?"font-bold bg-surface-200 dark:bg-surface-600 pl-4":"",a=this.chaptersTitles.get(r.shortTitle);return`<a href="${this.url}/${encodeURI(r.shortTitle)}"><li class="py-2 px-4 ${i} !text-black dark:!text-white">${t}${a}</li></a>`}).join("");const s=this.lo.los.findIndex(r=>encodeURI(r.shortTitle)===this.currentChapterShortTitle);if(s!==-1){const r=this.lo.los[s-1],i=r?c(this.chaptersTitles.get(r.shortTitle)):"";this.horizontalNavbarHtml=r?`<a class="btn btn-sm capitalize" href="${this.url}/${encodeURI(r.shortTitle)}"> <span aria-hidden="true">&larr;</span>&nbsp; ${t}${i} </a>`:"";const a=this.lo.los[s+1],u=a?c(this.chaptersTitles.get(a.shortTitle)):"";this.horizontalNavbarHtml+=a?`<a class="ml-auto btn btn-sm capitalize" style="margin-left: auto" href="${this.url}/${encodeURI(a.shortTitle)}"> ${t}${u} &nbsp;<span aria-hidden="true">&rarr;</span></a>`:""}else this.horizontalNavbarHtml=""}setCurrentChapter(t){this.steps.includes(t)&&(this.currentChapterShortTitle=t,this.currentChapterTitle=this.chaptersTitles.get(t),this.content=this.chaptersHtml.get(t),this.refreshNav())}setFirstPageActive(){const t=encodeURI(this.lo.los[0].shortTitle);this.setCurrentChapter(t)}setActivePage(t){this.setCurrentChapter(t)}nextStep(){const t=this.steps.indexOf(this.currentChapterShortTitle);return t<this.steps.length-1?this.steps[t+1]:""}prevStep(){const t=this.steps.indexOf(this.currentChapterShortTitle);return t>0?this.steps[t-1]:""}}const x={course:h,courses:new Map,courseUrl:"",async getOrLoadCourse(e){let t=this.courses.get(e),s=e;if(!t){!e.includes(".netlify.app")&&!e.includes(".tutors.dev")?s=`${e}.netlify.app`:e=e.split(".")[0];try{const i=await(await fetch(`https://${s}/tutors.json`)).json();t=new h(i,e,s),this.courses.set(e,t)}catch(r){throw console.log(r),r}}return t},async readCourse(e){const t=await this.getOrLoadCourse(e);return m.set(t),T.set(t.url),f.set(t==null?void 0:t.currentWeek),this.course=t,t},async readTopic(e,t){const r=(await this.readCourse(e)).topicIndex.get(t);return n.set(r.lo),r},async readLab(e,t){const s=await this.readCourse(e);t.substring(t.lastIndexOf("/")+1).startsWith("book")||(t=t.slice(0,t.lastIndexOf("/")));const i=s.loIndex.get(t),a=s.hydratedLabs.get(t)||new g(s,i,t);return s.hydratedLabs.set(t,a),n.set(a.lo),a},async readWall(e,t){return(await this.readCourse(e)).walls.get(t)},async readLo(e,t){const r=(await this.readCourse(e)).loIndex.get(t);return n.set(r),r}};export{x as c};
