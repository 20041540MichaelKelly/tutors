import{S as Te,i as we,s as Ae,k as m,y as se,a as H,q as Z,l as p,m as _,z as ae,c as C,r as x,h as d,n as c,b as re,P as f,A as le,u as ee,v as Re,d as A,f as Se,g as E,W as De,X as _e,B as ie,af as ge,Y as ve,ag as Le,a3 as Pe}from"./index.724b717b.js";import{A as Ne,I as Ue}from"./pdf.worker.entry.84f9d3a5.js";import{l as Oe,k as G,e as te,d as Ve,c as He}from"./stores.e6516f52.js";import{C as be}from"./course.d958946a.js";import{b as $e}from"./animations.819f5aa5.js";import{d as Ce,i as Me}from"./auth-utils.95622764.js";import{f as je,h as qe,j as W,k as Ie,o as ke,l as ze,m as Be}from"./environment.b701a005.js";function We(a){let e,r,s;return{c(){e=m("img"),this.h()},l(t){e=p(t,"IMG",{loading:!0,class:!0,src:!0,alt:!0}),this.h()},h(){c(e,"loading","lazy"),c(e,"class","mx-auto "+Xe),ge(e.src,r=a[0].loImage)||c(e,"src",r),c(e,"alt",s=a[0].loTitle)},m(t,l){re(t,e,l)},p(t,l){l&1&&!ge(e.src,r=t[0].loImage)&&c(e,"src",r),l&1&&s!==(s=t[0].loTitle)&&c(e,"alt",s)},i:ve,o:ve,d(t){t&&d(e)}}}function Fe(a){let e,r;return e=new Ue({props:{icon:a[0].loIcon.type,color:a[0].loIcon.color,height:a[1]}}),{c(){se(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,t){le(e,s,t),r=!0},p(s,t){const l={};t&1&&(l.icon=s[0].loIcon.type),t&1&&(l.color=s[0].loIcon.color),t&2&&(l.height=s[1]),e.$set(l)},i(s){r||(E(e.$$.fragment,s),r=!0)},o(s){A(e.$$.fragment,s),r=!1},d(s){ie(e,s)}}}function Ge(a){let e,r,s,t,l,i,u,n=a[0].studentName+"",T,X,R,w,g,v,Y,b,S,D,O=a[0].courseTitle+"",M,J,K,Q,L,P,V=a[0].loTitle+"",j,q,k,z,$;l=new Ne({props:{src:a[0].studentImg,alt:a[0].studentName,class:"mr-2"}});const ne=[Fe,We],y=[];function oe(o,h){return o[0].loIcon?0:1}return g=oe(a),v=y[g]=ne[g](a),{c(){e=m("a"),r=m("div"),s=m("div"),t=m("header"),se(l.$$.fragment),i=H(),u=m("h6"),T=Z(n),X=H(),R=m("div"),w=m("div"),v.c(),Y=H(),b=m("footer"),S=m("p"),D=m("span"),M=Z(O),J=H(),K=m("hr"),Q=H(),L=m("p"),P=m("span"),j=Z(V),this.h()},l(o){e=p(o,"A",{href:!0,target:!0,rel:!0});var h=_(e);r=p(h,"DIV",{class:!0});var I=_(r);s=p(I,"DIV",{class:!0});var N=_(s);t=p(N,"HEADER",{class:!0});var B=_(t);ae(l.$$.fragment,B),i=C(B),u=p(B,"H6",{});var ce=_(u);T=x(ce,n),ce.forEach(d),B.forEach(d),N.forEach(d),X=C(I),R=p(I,"DIV",{class:!0});var ue=_(R);w=p(ue,"DIV",{class:!0});var fe=_(w);v.l(fe),fe.forEach(d),ue.forEach(d),Y=C(I),b=p(I,"FOOTER",{class:!0});var U=_(b);S=p(U,"P",{class:!0});var de=_(S);D=p(de,"SPAN",{class:!0});var he=_(D);M=x(he,O),he.forEach(d),de.forEach(d),J=C(U),K=p(U,"HR",{}),Q=C(U),L=p(U,"P",{class:!0});var me=_(L);P=p(me,"SPAN",{class:!0});var pe=_(P);j=x(pe,V),pe.forEach(d),me.forEach(d),U.forEach(d),I.forEach(d),h.forEach(d),this.h()},h(){c(t,"class","card-header inline-flex items-center"),c(s,"class","flex"),c(w,"class","my-2 justify-center"),c(R,"class","card-body"),c(D,"class","italic"),c(S,"class","mt-2 mb-2 font-semibold"),c(P,"class","italic"),c(L,"class","mt-2"),c(b,"class","card-footer text-center"),c(r,"class",q="card !bg-surface-50 dark:!bg-surface-700 border-y-8 border-primary-500 m-2 w-56 "+a[2]+" transition-all hover:scale-105"),c(e,"href",z="https://next.tutors.dev"+a[0].loRoute),c(e,"target","_blank"),c(e,"rel","noreferrer")},m(o,h){re(o,e,h),f(e,r),f(r,s),f(s,t),le(l,t,null),f(t,i),f(t,u),f(u,T),f(r,X),f(r,R),f(R,w),y[g].m(w,null),f(r,Y),f(r,b),f(b,S),f(S,D),f(D,M),f(b,J),f(b,K),f(b,Q),f(b,L),f(L,P),f(P,j),$=!0},p(o,[h]){const I={};h&1&&(I.src=o[0].studentImg),h&1&&(I.alt=o[0].studentName),l.$set(I),(!$||h&1)&&n!==(n=o[0].studentName+"")&&ee(T,n);let N=g;g=oe(o),g===N?y[g].p(o,h):(Re(),A(y[N],1,1,()=>{y[N]=null}),Se(),v=y[g],v?v.p(o,h):(v=y[g]=ne[g](o),v.c()),E(v,1),v.m(w,null)),(!$||h&1)&&O!==(O=o[0].courseTitle+"")&&ee(M,O),(!$||h&1)&&V!==(V=o[0].loTitle+"")&&ee(j,V),(!$||h&4&&q!==(q="card !bg-surface-50 dark:!bg-surface-700 border-y-8 border-primary-500 m-2 w-56 "+o[2]+" transition-all hover:scale-105"))&&c(r,"class",q),(!$||h&1&&z!==(z="https://next.tutors.dev"+o[0].loRoute))&&c(e,"href",z)},i(o){$||(E(l.$$.fragment,o),E(v),De(()=>{$&&(k||(k=_e(r,$e,{},!0)),k.run(1))}),$=!0)},o(o){A(l.$$.fragment,o),A(v),k||(k=_e(r,$e,{},!1)),k.run(0),$=!1},d(o){o&&d(e),ie(l),y[g].d(),o&&k&&k.end()}}}let Xe="h-32";function Ye(a,e,r){let{lo:s}=e,t="80",l="";return Oe.subscribe(i=>{i==="compacted"?(r(2,l="w-36 h-[21rem]"),r(1,t="80")):(r(2,l="w-60 h-[25rem]"),r(1,t="150"))}),a.$$set=i=>{"lo"in i&&r(0,s=i.lo)},[s,t,l]}class Je extends Te{constructor(e){super(),we(this,e,Ye,Ge,Ae,{lo:0})}}function ye(a,e,r){const s=a.slice();return s[1]=e[r],s}function Ee(a){let e,r;return e=new Je({props:{lo:a[1]}}),{c(){se(e.$$.fragment)},l(s){ae(e.$$.fragment,s)},m(s,t){le(e,s,t),r=!0},p(s,t){const l={};t&1&&(l.lo=s[1]),e.$set(l)},i(s){r||(E(e.$$.fragment,s),r=!0)},o(s){A(e.$$.fragment,s),r=!1},d(s){ie(e,s)}}}function Ke(a){let e,r,s=a[0],t=[];for(let i=0;i<s.length;i+=1)t[i]=Ee(ye(a,s,i));const l=i=>A(t[i],1,1,()=>{t[i]=null});return{c(){e=m("div");for(let i=0;i<t.length;i+=1)t[i].c();this.h()},l(i){e=p(i,"DIV",{class:!0});var u=_(e);for(let n=0;n<t.length;n+=1)t[n].l(u);u.forEach(d),this.h()},h(){c(e,"class","flex flex-wrap justify-center")},m(i,u){re(i,e,u);for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(e,null);r=!0},p(i,[u]){if(u&1){s=i[0];let n;for(n=0;n<s.length;n+=1){const T=ye(i,s,n);t[n]?(t[n].p(T,u),E(t[n],1)):(t[n]=Ee(T),t[n].c(),E(t[n],1),t[n].m(e,null))}for(Re(),n=s.length;n<t.length;n+=1)l(n);Se()}},i(i){if(!r){for(let u=0;u<s.length;u+=1)E(t[u]);r=!0}},o(i){t=t.filter(Boolean);for(let u=0;u<t.length;u+=1)A(t[u]);r=!1},d(i){i&&d(e),Le(t,i)}}}function Qe(a,e,r){let s;return Pe(a,G,t=>r(0,s=t)),[s]}class lt extends Te{constructor(e){super(),we(this,e,Qe,Ke,Ae,{})}}let F=!1;const it={db:{},user:{},userSummaryCache:new Map,course:be,lastCourse:be,students:new Map,los:new Array,listeners:new Map,startListening(a,e){this.listeners.set(a,e)},stopListening(a){this.listeners.delete(a)},updateListeners(a,e){for(const r of this.listeners.values())r(a,e)},sweepAndPurge(){const a=[];this.los.forEach(e=>{e.timeout--,e.timeout===0&&a.push(e)}),a.forEach(e=>{const r=this.los.indexOf(e);r!==-1&&this.los.splice(r,1),this.updateListeners("leave",e),this.students.delete(e.studentId)}),G.set([...this.los]),te.set(this.los.length)},async visitUpdate(a){const e=await(await je(qe(W(this.db),`all-course-access/${a}/lo`))).val();if(e){const r=Ce(e.tutorsTimeId);if(r&&this.user.email!==r){let s=await Ie(a,r);if(s||(s=await Ie(a,r)),s){const t={studentName:s.name,studentId:r,studentImg:s.picture,courseTitle:e.courseTitle,loTitle:e.title,loImage:e.img,loRoute:e.subRoute,loIcon:e.icon,timeout:7},l=this.students.get(r);l?(l.loTitle=t.loTitle,l.loImage=t.loImage,l.loRoute=t.loRoute,l.loIcon=t.loIcon,l.timeout=7,this.updateListeners("update",t)):(this.students.set(r,t),this.los.push(t),this.updateListeners("enter",t)),G.set([...this.los]),te.set(this.los.length)}}}},initService(a){setInterval(this.sweepAndPurge.bind(this),1e3*60),te.set(0),G.set([]),F=!1,setTimeout(function(){F=!0},5e3);let e=W(this.db,`all-course-access/${a.id}/visits`);ke(e,async()=>{F&&await this.visitUpdate(a.id)}),e=W(this.db,`all-course-access/${a.id}/count`),ke(e,async()=>{F&&await this.visitUpdate(a.id)})},startPresenceEngine(){this.db=ze(),Ve.subscribe(a=>{this.user=a}),He.subscribe(a=>{if(a&&a!=this.lastCourse){if(this.lastCourse){const e=W(this.db,`all-course-access/${this.lastCourse.id}/visits`);Be(e)}this.lastCourse=a,Me()&&(a==null?void 0:a.authLevel)>0&&this.initService(a)}})}};export{lt as S,it as p};
